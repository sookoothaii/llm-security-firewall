# Gitleaks Configuration for LLM Security Firewall
# Purpose: Allow fake test data, prevent real secrets
# Creator: Joerg Bollwahn
# Date: 2025-10-30

title = "LLM Security Firewall Gitleaks Config"

# Allowlist for fake test data and examples
[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)(api[_-]?key|apikey)(.{0,20})?['"\s:=]+([a-z0-9_\-]{20,})'''
[rules.allowlist]
# Allow API_KEY= in test files and benchmarks (fake test data)
paths = [
    '''tests/.*\.py$''',
    '''tests_firewall/.*\.py$''',
    '''scripts/.*\.py$''',
    '''benchmarks/.*\.py$''',
    '''examples/.*\.py$''',
    '''src/firewall_engine\.py$''',                               # Configuration class with API key variable names
    '''src/llm_firewall/gates/steganography_guard\.py$'''         # Configuration class with API key variable names
]
regexes = [
    '''API_KEY=(XYZ123|ABCD1234|xyz789)''',
    '''api_key=(XYZ123|ABCD1234|xyz789|leaked)''',
    '''first tokens: API_KEY''',
    '''sk-proj-ABCD1234567890''',
]

[[rules]]
id = "password"
description = "Password in code"
regex = '''(?i)(password|passwd|pwd)(.{0,20})?['"\s:=]+([^\s]{8,})'''
[rules.allowlist]
# Allow password= in test files (fake test data)
paths = [
    '''tests/.*\.py$''',
    '''tests_firewall/.*\.py$''',
    '''scripts/.*\.py$''',
    '''benchmarks/.*\.py$''',
    '''src/llm_firewall/gates/safety_sandwich\.py$''',           # Regex pattern in code
    '''src/llm_firewall/gates/secrets_heuristics\.py$''',        # Password detection patterns (L106-119)
    '''src/llm_firewall/monitoring/influence_budget_repo\.py$''', # Default DSN fallback
    '''src/llm_firewall/safety/validator\.py$''',                # Test strings
    '''src/llm_firewall/detectors/cyber_ops\.py$''',              # Lexicon strings (password extraction, etc.)
    '''kids_policy/truth_preservation/validators/semantic_grooming_guard\.py$''',  # Example strings in threat patterns
    '''src/firewall_engine\.py$''',                              # Regex patterns for path detection
    '''src/llm_firewall/gates/normalization_guard\.py$''',        # Regex patterns for path detection
]
regexes = [
    '''password=(admin123|test123)''',
    '''password.*admin''',
    '''password extraction''',                                    # Lexicon string in cyber_ops.py
    '''first tokens: password''',
    '''r"\\bpassword\\s\*''',                                    # Python regex pattern
    '''postgresql://hakgal:password@localhost''',                # Default DSN
    '''bypass Windows password login''',                         # Test string
    '''REDACTED''',                                               # Test payload marker
    '''\[\[SECRET.*?\]\]''',                                      # Test secret placeholders
    '''# S105: test.*passwords/secrets.*censored''',              # Config file comments
    '''test.*REDACTED''',                                         # Test-related usage
    '''crack authentication and security''',                      # Threat pattern example
    '''\/etc\/(?:passwd|shadow)''',                               # System path in regex patterns
]

# Global allowlist for documentation and examples
[allowlist]
description = "Global allowlist for safe patterns"
paths = [
    '''.*\.md$''',
    '''.*\.txt$''',
    '''.*\.yaml$''',
    '''.*\.yml$''',
    '''pyproject\.toml$''',            # Config file (ruff S105 comment contains test marker word)
    '''ruff\.toml$''',                 # Lint config (comment contains test marker word)
    '''LICENSE''',
    '''data/.*\.csv$''',              # Test data CSV files
    '''data/.*\.jsonl$''',             # Adversarial test data (synthetic secrets)
    '''results/.*\.json$''',           # Test results/reports
    '''docker-compose\.yml$''',        # Docker config with env placeholders
]
regexes = [
    '''DB_PASSWORD=\$\{DB_PASSWORD\}''',                             # Docker env placeholder
    '''POSTGRES_PASSWORD=\$\{DB_PASSWORD\}''',                       # Docker env placeholder
]
